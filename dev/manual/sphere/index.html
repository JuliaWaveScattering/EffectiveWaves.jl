<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Scattering from a sphere · EffectiveWaves.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">EffectiveWaves.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../introduction/">Quick introduction</a></li><li><a class="tocitem" href="../background/">Background</a></li><li><a class="tocitem" href="../wavenumbers/">Effective wavenumbers</a></li><li><a class="tocitem" href="../reflection/">Reflection and transmission</a></li><li class="is-active"><a class="tocitem" href>Scattering from a sphere</a><ul class="internal"><li><a class="tocitem" href="#Choose-the-microstructure"><span>Choose the microstructure</span></a></li><li><a class="tocitem" href="#Is-one-effective-wavenumber-enough?"><span>Is one effective wavenumber enough?</span></a></li><li><a class="tocitem" href="#Define-the-source-and-material"><span>Define the source and material</span></a></li><li><a class="tocitem" href="#Calculate-the-scattered-waves"><span>Calculate the scattered waves</span></a></li><li><a class="tocitem" href="#Calculate-the-field"><span>Calculate the field</span></a></li><li><a class="tocitem" href="#Plot-the-field"><span>Plot the field</span></a></li><li class="toplevel"><a class="tocitem" href="#Plot-a-gif"><span>Plot a gif</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../library/library/">Library</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/vary_two_species/README/">Vary volume fraction of the two species</a></li><li><a class="tocitem" href="../../examples/equivalent-symmetries/README/">Equivalent symmetries</a></li><li><a class="tocitem" href="../../examples/matched_method/README/">A numerical matching method</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Scattering from a sphere</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Scattering from a sphere</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaWaveScattering/EffectiveWaves.jl/blob/master/docs/src/manual/sphere.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Scattering-from-a-sphere"><a class="docs-heading-anchor" href="#Scattering-from-a-sphere">Scattering from a sphere</a><a id="Scattering-from-a-sphere-1"></a><a class="docs-heading-anchor-permalink" href="#Scattering-from-a-sphere" title="Permalink"></a></h1><p>Here we show how to calculate the average acoustic wave scattered from a sphere filled with particles. We will the analytic solution with an approximation using effective low frequency properties.</p><h2 id="Choose-the-microstructure"><a class="docs-heading-anchor" href="#Choose-the-microstructure">Choose the microstructure</a><a id="Choose-the-microstructure-1"></a><a class="docs-heading-anchor-permalink" href="#Choose-the-microstructure" title="Permalink"></a></h2><pre><code class="language-julia">using EffectiveWaves, LinearAlgebra

spatial_dim = 3
medium = Acoustic(spatial_dim; ρ=1.0, c=1.0)

s1 = Specie(
    Acoustic(spatial_dim; ρ=10.0, c=10.0), Sphere(spatial_dim, 1.0);
    volume_fraction=0.15
);
s2 = Specie(
    Acoustic(spatial_dim; ρ=0.22, c=0.22), Sphere(spatial_dim, 1.0);
    volume_fraction=0.05
);
species = [s1,s2]

# calculate the low frequency effective properties
eff_medium = effective_medium(medium, species)

# choose incident angular frequency
ω = 0.22

# choose maximum order of the spherical harmonic for scattered waves from particles
basis_order = 2

# choose a numerical tolerance
tol = 1e-7

# calculate the effective wavenumbers which are valid for any frequency low frequency effective properties
opts = Dict(
    :num_wavenumbers =&gt; 2, # calculate at least 3 wavenumbers
    :basis_order =&gt; basis_order,
    :tol =&gt; tol
)

# note this is the heaviest calculation in this example
k_effs = wavenumbers(ω, medium, species; opts...)</code></pre><h2 id="Is-one-effective-wavenumber-enough?"><a class="docs-heading-anchor" href="#Is-one-effective-wavenumber-enough?">Is one effective wavenumber enough?</a><a id="Is-one-effective-wavenumber-enough?-1"></a><a class="docs-heading-anchor-permalink" href="#Is-one-effective-wavenumber-enough?" title="Permalink"></a></h2><p>To easily calculate scattered waves we need <code>k_effs[1]</code> to have a smaller imaginary part than the other wavenumbers <code>k_effs[2:end]</code>. This is easily checked with a scatter plot</p><pre><code class="language-julia">using Plots
pyplot(size = (600, 350))

scatter(k_effs, lab = &quot;kp&quot;, ylims = (0.0,Inf))  
# savefig(&quot;../assets/sphere-wavenumbers.png&quot;)</code></pre><p><img src="../../assets/sphere-wavenumbers.png" alt="sphere-wavenumbers.png"/></p><p>When using only one wavenumber, and excluding the other wavenumber, will lead to an error that is roughly given by</p><pre><code class="language-julia">λ = 2π * medium.c / ω
approximate_error = abs(exp(im * λ * k_effs[2]) / exp(im * λ * k_effs[1]))

# output

1.5188e-6 # approximately</code></pre><p>The precise error depends on the application.</p><h2 id="Define-the-source-and-material"><a class="docs-heading-anchor" href="#Define-the-source-and-material">Define the source and material</a><a id="Define-the-source-and-material-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-source-and-material" title="Permalink"></a></h2><p>As we want to calculate effective scattered waves, and not just effective wavenumbers, we need to define a source and material domain. We will choose a plane-wave source, and a sphere for the domain.  </p><pre><code class="language-julia"># choose an incident wave
# NOTE: having the incident wave direction along the z-axis leads to azimuthal symmetry, which simplifies the next steps.
θ = 0.0
psource = PlaneSource(medium, [sin(θ),0.0,cos(θ)]);

# choose the size and position of the spherical domain of the material
R = 20.0
material = Material(Sphere(spatial_dim, R),species);

# the larger the material region, the larger this basis_field_order needs to be
basis_field_order = 7</code></pre><h2 id="Calculate-the-scattered-waves"><a class="docs-heading-anchor" href="#Calculate-the-scattered-waves">Calculate the scattered waves</a><a id="Calculate-the-scattered-waves-1"></a><a class="docs-heading-anchor-permalink" href="#Calculate-the-scattered-waves" title="Permalink"></a></h2><p>Below we calculate the outward going spherical wave coefficients. These coefficients, multiplied with a basis of outward going waves, will give the scattered field.</p><pre><code class="language-julia"># create a sphere using the low frequency effective properties
effective_sphere = Particle(eff_medium, material.shape)

region_order = basis_order + basis_field_order

# calculate the T-matrix, also know as scattering matrix, and take the diagonal
t_mat = t_mat(effective_sphere, medium, ω, region_order);

# calculate the outward going spherical wave coefficients
source_coefficients = regular_spherical_coefficients(psource)(region_order,zeros(3),ω);
scat_low_coefficients = t_mat * source_coefficients

# for the analytic solution, we need the wavemode first
wave = WaveMode(ω, k_effs[1], psource, material;
        tol=tol,
        basis_order = basis_order,
        basis_field_order = basis_field_order
)

# and then the outward spherical wave coefficients
scat_coefficients = material_scattering_coefficients(wave)</code></pre><h2 id="Calculate-the-field"><a class="docs-heading-anchor" href="#Calculate-the-field">Calculate the field</a><a id="Calculate-the-field-1"></a><a class="docs-heading-anchor-permalink" href="#Calculate-the-field" title="Permalink"></a></h2><pre><code class="language-julia">xlim = 3.0 * R
ylim = 4.4 * R

# a region to plot
region = Box([[-xlim,-ylim], [xlim,ylim]]);

# a quick fix to make it a 3D region
xs, xinds = points_in_shape(region; res = 180);
xs = [[x[1],0,x[2]] for x in xs];

# Calculate the field for the low frequency effective properties
particles = [Particle(eff_medium,material.shape)]
sim = FrequencySimulation(particles, psource)
fs = field(sim, ω, xs[xinds], scat_low_coefficients);

field_mat = zeros(typeof(fs[1]), length(xs), 1);
field_mat[xinds,:] = fs;
result_low = FrequencySimulationResult(field_mat, xs, [ω])


# Calculate the analytic scattered field
fs = field(sim, ω, xs[xinds], scat_coefficients);

field_mat = zeros(typeof(fs[1]), length(xs), 1);
field_mat[xinds,:] = fs;
result = FrequencySimulationResult(field_mat, xs, [ω])</code></pre><h2 id="Plot-the-field"><a class="docs-heading-anchor" href="#Plot-the-field">Plot the field</a><a id="Plot-the-field-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-field" title="Permalink"></a></h2><pre><code class="language-julia">
pyplot( frame = :axes,
    size = (xlim * 5.0, ylim * 4.0),
    flip = false,
    xlims = :auto, ylims = :auto,
    title=&quot;&quot;, xlab=&quot;ka&quot;,ylab=&quot;y&quot;
)

plot(result_low, ω, seriestype = :contour, field_apply=abs
, color = :balance # for julia 1.1 change to color = :pu_or
, levels = 16, clims=(0.0,1.65)
, title = &quot;abs low freq. scat&quot;
, axis=false)
plot!(material.shape)
p_scat = plot!(leg = false, frame = :none
,axis=false, xlab=&quot;&quot;,ylab=&quot;&quot;)

# savefig(&quot;../assets/low-freq-scat-sphere.png&quot;)</code></pre><p><img src="../../assets/low-freq-scat-sphere.png" alt="low-freq-scat-sphere.png"/></p><pre><code class="language-julia">plot(result,ω, seriestype = :contour, field_apply=abs
, levels = 16, clims=(0.0,1.65)
, title = &quot;abs scattered field&quot;
, color = :balance
, colorbar = false
)
plot!(material.shape)
plot!(leg = false
, axis=false, xlab=&quot;&quot;,ylab=&quot;&quot;)

# savefig(&quot;../assets/scat-sphere.png&quot;)</code></pre><p><img src="../../assets/scat-sphere.png" alt="scat-sphere.png"/></p><h1 id="Plot-a-gif"><a class="docs-heading-anchor" href="#Plot-a-gif">Plot a gif</a><a id="Plot-a-gif-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-a-gif" title="Permalink"></a></h1><p>Finally, for fun, we plot a GIF of the real part of the full field.</p><pre><code class="language-julia">max_c = maximum(abs.(field(result)))
min_c = - max_c

ts = LinRange(0.,2pi/ω,30)

anim = @animate for t in ts
    plot(result, ω, seriestype=:contour
        , levels = 20
        , phase_time=t
        , leg = false
        , field_apply = real
        , clim = (min_c, max_c)
        , colorbar = false
        , color = :balance
        , frame = :none
        , title = &quot;Re. full field&quot;
    )
    plot!(material.shape)
    plot!(leg = false, frame = :none
    , axis=false, xlab=&quot;&quot;,ylab=&quot;&quot;)

end
# gif(anim,&quot;../assets/real-sphere-scatter.gif&quot;, fps = 7)

anim = @animate for t in ts
    plot(result_low, ω, seriestype=:contour
        , levels = 20
        , phase_time=t
        , leg = false
        , field_apply = real
        , clim = (min_c, max_c)
        , colorbar = false
        , color = :balance
        , frame = :none
        , title = &quot;Re. low freq full field&quot;
    )
    plot!(material.shape)
    plot!(leg = false, frame = :none
    , axis=false, xlab=&quot;&quot;,ylab=&quot;&quot;)

end
# gif(anim,&quot;../assets/real-sphere-low-scat-scatter.gif&quot;, fps = 7)
</code></pre><p><img src="../../assets/real-sphere-scatter.gif" alt="real-sphere-scatter.gif"/> <img src="../../assets/real-sphere-low-scat-scatter.gif" alt="real-sphere-low-scat-scatter.gif"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../reflection/">« Reflection and transmission</a><a class="docs-footer-nextpage" href="../../library/library/">Library »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 23 April 2021 12:46">Friday 23 April 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
